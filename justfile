# ============================================================================
# üìö –ö–û–ú–ê–ù–î–´ –î–õ–Ø –ö–£–†–°–û–í–û–ô –†–ê–ë–û–¢–´
# ============================================================================

# –§–∞–π–ª –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
main := "main.typ"
output := "main.pdf"

# ============================================================================
# üî® –°–±–æ—Ä–∫–∞
# ============================================================================

# –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å PDF
build:
    typst compile {{main}}

# Watch —Ä–µ–∂–∏–º (–∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö)
watch:
    typst watch {{main}}

# –£–¥–∞–ª–∏—Ç—å —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π PDF
clean:
    rm -f {{output}}

# –û—Ç–∫—Ä—ã—Ç—å PDF
open:
    xdg-open {{output}} 2>/dev/null || open {{output}} 2>/dev/null || start {{output}}

# –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –∏ –æ—Ç–∫—Ä—ã—Ç—å
run: build open

# ============================================================================
# üìù –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
# ============================================================================

# –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ .typ —Ñ–∞–π–ª—ã
fmt:
    typstyle format-all .

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
fmt-check:
    typstyle format-all --check .

# ============================================================================
# üì• –†–∞–±–æ—Ç–∞ —Å –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏ (input/)
# ============================================================================

# –ü–æ–∫–∞–∑–∞—Ç—å —á—Ç–æ –µ—Å—Ç—å –≤ input/
input-status:
    @echo "üì• –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –≤ input/:"
    @echo ""
    @echo "üìù –ß–µ—Ä–Ω–æ–≤–∏–∫–∏ (drafts/):"
    @ls -la input/drafts/ 2>/dev/null | grep -v "^total\|^d\|gitkeep" || echo "   (–ø—É—Å—Ç–æ)"
    @echo ""
    @echo "üíª –ö–æ–¥ (code/):"
    @ls -la input/code/ 2>/dev/null | grep -v "^total\|^d\|gitkeep" || echo "   (–ø—É—Å—Ç–æ)"
    @echo ""
    @echo "üìä –î–∞–Ω–Ω—ã–µ (data/):"
    @ls -la input/data/ 2>/dev/null | grep -v "^total\|^d\|gitkeep" || echo "   (–ø—É—Å—Ç–æ)"
    @echo ""
    @echo "üìö –ò—Å—Ç–æ—á–Ω–∏–∫–∏ (references/):"
    @ls -la input/references/ 2>/dev/null | grep -v "^total\|^d\|gitkeep" || echo "   (–ø—É—Å—Ç–æ)"

# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ input/data –≤ assets/
copy-images:
    @echo "üì∑ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ input/data/ –≤ assets/..."
    @cp input/data/*.png assets/ 2>/dev/null || true
    @cp input/data/*.jpg assets/ 2>/dev/null || true
    @cp input/data/*.jpeg assets/ 2>/dev/null || true
    @cp input/data/*.svg assets/ 2>/dev/null || true
    @echo "‚úÖ –ì–æ—Ç–æ–≤–æ."

# ============================================================================
# üìÅ –°–ø—Ä–∞–≤–∫–∞
# ============================================================================

# –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞
tree:
    @echo "üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:"
    @echo ""
    @echo "  main.typ              ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞"
    @echo "  meta.typ              ‚Äî –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ (–†–ï–î–ê–ö–¢–ò–†–û–í–ê–¢–¨!)"
    @echo ""
    @echo "  lib/                  ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–Ω–µ —Ç—Ä–æ–≥–∞—Ç—å)"
    @echo "    core.typ            ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ —à—Ä–∏—Ñ—Ç–æ–≤"
    @echo "    title-page.typ      ‚Äî —Ç–∏—Ç—É–ª—å–Ω—ã–π –ª–∏—Å—Ç"
    @echo "    headings.typ        ‚Äî —Å—Ç–∏–ª–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤"
    @echo "    elements.typ        ‚Äî fig(), tbl(), code-block()"
    @echo "    diagrams.typ        ‚Äî CeTZ/CeTZ-Plot –æ–±—ë—Ä—Ç–∫–∏"
    @echo "    bibliography.typ    ‚Äî —Å–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤"
    @echo ""
    @echo "  content/              ‚Äî –≥–ª–∞–≤—ã –∫—É—Ä—Å–æ–≤–æ–π (–ó–î–ï–°–¨ –ü–ò–°–ê–¢–¨!)"
    @echo "    00-abstract.typ     ‚Äî –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è"
    @echo "    01-intro.typ        ‚Äî –≤–≤–µ–¥–µ–Ω–∏–µ"
    @echo "    02-chapter-1.typ    ‚Äî –≥–ª–∞–≤–∞ 1"
    @echo "    03-chapter-2.typ    ‚Äî –≥–ª–∞–≤–∞ 2"
    @echo "    04-chapter-3.typ    ‚Äî –≥–ª–∞–≤–∞ 3"
    @echo "    05-conclusion.typ   ‚Äî –∑–∞–∫–ª—é—á–µ–Ω–∏–µ"
    @echo "    06-references.typ   ‚Äî —Å–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤"
    @echo ""
    @echo "  appendices/           ‚Äî –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
    @echo "  assets/               ‚Äî –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è"
    @echo "  input/                ‚Äî –∏—Å—Ö–æ–¥–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã (‚õî read-only!)"

# –°–ø—Ä–∞–≤–∫–∞
help:
    @echo "üìö –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∫—É—Ä—Å–æ–≤–æ–π —Ä–∞–±–æ—Ç—ã"
    @echo ""
    @echo "üî® –°–±–æ—Ä–∫–∞:"
    @echo "  just build        ‚Äî —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å PDF"
    @echo "  just watch        ‚Äî –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö"
    @echo "  just run          ‚Äî —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –∏ –æ—Ç–∫—Ä—ã—Ç—å"
    @echo "  just open         ‚Äî –æ—Ç–∫—Ä—ã—Ç—å PDF"
    @echo "  just clean        ‚Äî —É–¥–∞–ª–∏—Ç—å PDF"
    @echo ""
    @echo "üìù –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:"
    @echo "  just fmt          ‚Äî –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å .typ —Ñ–∞–π–ª—ã"
    @echo "  just fmt-check    ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"
    @echo ""
    @echo "üì• –ú–∞—Ç–µ—Ä–∏–∞–ª—ã:"
    @echo "  just input-status ‚Äî —á—Ç–æ –µ—Å—Ç—å –≤ input/"
    @echo "  just copy-images  ‚Äî —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∏ –≤ assets/"
    @echo ""
    @echo "üìÅ –ü—Ä–æ—á–µ–µ:"
    @echo "  just tree         ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É"
    @echo "  just help         ‚Äî —ç—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞"
