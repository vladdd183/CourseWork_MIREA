---
description: "Конвенции написания Typst-кода и использования утилит"
globs: "**/*.typ"
alwaysApply: false
---

# Стиль написания Typst-кода

## Общие правила

1. **Используй утилиты** из `lib/elements.typ` вместо ручного форматирования:
   - `fig("path", "Название")` — рисунок по ГОСТ (секционная нумерация 2.1)
   - `fig-placeholder("Описание")` — заглушка для отсутствующего изображения
   - `tbl("Название", columns: ..., ...)` — таблица (серая шапка, zebra: true для полос)
   - `long-tbl("Название", columns: ..., header: (...), ...)` — длинная таблица с повтором заголовка
   - `code-block("Название")[...]` — листинг кода с номерами строк
   - `code-file("path", "Название")` — листинг из файла (автодетект языка по расширению)
   - `appendix("А", "Название")[...]` — приложение по ГОСТ
   - НЕ делай `#figure(image(...), caption: ...)` напрямую!

2. **Цитирование источников:**
   - `cite-src(1)` → [1]
   - `cite-src(1, 2, 3)` → [1, 2, 3]
   - `cite-range(5, 7)` → [5-7]
   - Номера соответствуют позиции в `sources.typ` или ручном списке в `06-references.typ`

3. **Кросс-ссылки на элементы:**
   - `fig-num(<fig:label>)` → "2.1" (для рисунков)
   - `table-num(<tbl:label>)` → "1.3" (для таблиц)
   - `listing-num(<lst:label>)` → "3.2" (для листингов)
   - В тексте: "как показано на рисунке #fig-num(<fig:arch>)"

4. **Используй CeTZ/CeTZ-Plot** для диаграмм вместо растровых картинок:
   - `gost-canvas({...})` — канвас с ГОСТ-шрифтами
   - `gost-plot(...)` — график
   - `gost-piechart(...)` — круговая диаграмма
   - `gost-barchart(...)` — столбчатая диаграмма
   - Справочник примеров: https://diagrams.janosh.dev/
   - Документация: https://github.com/cetz-package/cetz-plot

5. **Комментарии на русском**, кроме технических терминов

6. **Не хардкодь форматирование** в content/ файлах:
   - НЕ делай `#set text(size: 14pt)` в главах
   - НЕ делай `#set page(margin: ...)` в главах
   - Всё оформление — через `lib/` и `meta.typ`

7. **Каждый файл в content/ начинается** с блока комментариев

## Импорт утилит

В файлах content/ импортируйте по необходимости:

```typst
// Цитирование и рисунки
#import "../lib/elements.typ": cite-src, cite-range, fig, fig-placeholder, tbl

// Код
#import "../lib/elements.typ": code-block, code-file

// Диаграммы
#import "../lib/diagrams.typ": gost-canvas, gost-plot, gost-piechart, gost-barchart
```

## Typst MCP

Для проверки синтаксиса Typst используй MCP:
- `check_if_snippet_is_valid_typst_syntax` — проверить фрагмент кода
- `latex_snippet_to_typst` — конвертировать формулы из LaTeX
- `list_docs_chapters` / `get_docs_chapter` — документация Typst

## Нумерация

Все элементы нумеруются секционно (Раздел.Номер):
- Рисунок 2.1, 2.2...
- Таблица 1.1, 1.2...
- Листинг 3.1, 3.2...
- Формула (1.1), (1.2)...

Счётчики сбрасываются при каждом новом заголовке уровня 1.
